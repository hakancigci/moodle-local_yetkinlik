<div class="local_yetkinlik_competency_exams">
    {{! 1. Competency Selection Filter }}
    <div class="card mb-4 border-0 shadow-sm bg-light">
        <div class="card-body">
            <form method="get" id="competency_filter_form">
                <input type="hidden" name="courseid" value="{{courseid}}">
                <div class="form-row align-items-end">
                    <div class="col-12 col-md-9 mb-3 mb-md-0">
                        <label class="font-weight-bold" for="id_competency_select">{{#str}}selectcompetency, local_yetkinlik{{/str}}</label>
                        <select name="competencyid" id="id_competency_select" class="form-control">
                            <option value="0">{{#str}}selectcompetency, local_yetkinlik{{/str}}</option>
                            {{#competencies}}
                                <option value="{{id}}" {{#selected}}selected{{/selected}}>{{shortname}}</option>
                            {{/competencies}}
                        </select>
                    </div>
                    <div class="col-12 col-md-3">
                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fa fa-search"></i> {{#str}}show, local_yetkinlik{{/str}}
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    {{#has_selection}}
        {{#description}}
        <div class="alert alert-info border-left-info shadow-sm mb-4">
            <i class="fa fa-info-circle"></i> {{{description}}}
        </div>
        {{/description}}

        {{! 2. Summary Table }}
        {{#rows.0}}
        <h4 class="mt-4">{{#str}}summaryreport, local_yetkinlik{{/str}}</h4>
        <div class="table-responsive">
            <table class="generaltable table table-hover shadow-sm bg-white">
                <thead class="thead-dark">
                    <tr>
                        <th>{{#str}}quiz, local_yetkinlik{{/str}}</th>
                        <th class="text-center">{{#str}}question, local_yetkinlik{{/str}}</th>
                        <th class="text-center">{{#str}}correct, local_yetkinlik{{/str}}</th>
                        <th class="text-center">{{#str}}success, local_yetkinlik{{/str}}</th>
                    </tr>
                </thead>
                <tbody>
                    {{#rows}}
                    <tr>
                        <td><strong>{{quizname}}</strong></td>
                        <td class="text-center">{{questions}}</td>
                        <td class="text-center">{{correct}}</td>
                        <td class="text-center font-weight-bold {{colorclass}}">%{{rate}}</td>
                    </tr>
                    {{/rows}}
                </tbody>
                <tfoot>
                    {{#total}}
                    <tr class="table-secondary font-weight-bold">
                        <td>{{#str}}total, local_yetkinlik{{/str}}</td>
                        <td class="text-center">{{questions}}</td>
                        <td class="text-center">{{correct}}</td>
                        <td class="text-center {{colorclass}}">%{{rate}}</td>
                    </tr>
                    {{/total}}
                </tfoot>
            </table>
        </div>
        {{/rows.0}}

        {{! 3. Detailed Question Links (New Section) }}
        {{#has_questions}}
        <h4 class="mt-5">{{#str}}questionlinks, local_yetkinlik{{/str}}</h4>
        <div class="table-responsive">
            <table class="generaltable table table-bordered table-hover mt-3 shadow-sm bg-white">
                <thead class="thead-light">
                    <tr>
                        <th>{{#str}}quiz, local_yetkinlik{{/str}}</th>
                        <th>{{#str}}questionname, local_yetkinlik{{/str}}</th>
                        <th class="text-center">{{#str}}action, local_yetkinlik{{/str}}</th>
                    </tr>
                </thead>
                <tbody>
                    {{#question_details}}
                    <tr>
                        <td>{{quizname}}</td>
                        <td>{{questionname}}</td>
                        <td class="text-center">
                            <a href="{{url}}" class="btn btn-sm btn-outline-primary view-question-modal">
                                <i class="fa fa-search"></i> {{#str}}viewattempt, local_yetkinlik{{/str}}
                            </a>
                        </td>
                    </tr>
                    {{/question_details}}
                </tbody>
            </table>
        </div>
        {{/has_questions}}

        {{^rows}}
            <div class="alert alert-warning shadow-sm">
                <i class="fa fa-exclamation-triangle"></i> {{#str}}nocompetencyexamdata, local_yetkinlik{{/str}}
            </div>
        {{/rows}}
    {{/has_selection}}
</div>

{{#js}}
require(['core/form-autocomplete', 'local_yetkinlik/modal_viewer'], function(Autocomplete, ModalViewer) {
    Autocomplete.enhance('#id_competency_select', false, false, "{{#str}}selectcompetency, local_yetkinlik{{/str}}");
    ModalViewer.init('.view-question-modal');
});
{{/js}}
